// Animate function to rotate planets and update labels
function animate() {
    requestAnimationFrame(animate);

    const speedMultiplier = parseFloat(speedControl.value);

    // Move the sun upwards (increased speed based on control)
    sun.position.y += 0.05 * speedMultiplier; // Use the speed multiplier for upward movement

    planets.forEach(planetData => {
        // Move the pivot upwards
        planetData.pivot.position.y = sun.position.y; // Keep the pivot moving upwards

        planetData.pivot.rotation.y += planetData.orbitSpeed * speedMultiplier;

        // Update label position to follow the planet
        const planetPosition = new THREE.Vector3();
        planetData.planet.getWorldPosition(planetPosition);
        planetData.label.position.set(planetPosition.x, planetPosition.y + planetData.planet.geometry.parameters.radius + 1, planetPosition.z);

        // Update trail points and manage visibility
        if (planetData.isTrailVisible) {
            planetData.timeElapsed += 1 / 60; // Increment time (60 FPS assumption)
            if (planetData.timeElapsed > 10) {
                planetData.isTrailVisible = false; // Set trail visibility to false after 10 seconds
            }
        }

        // Update the trail geometry
        if (planetData.isTrailVisible) {
            planetData.trailPoints.push([planetPosition.x, planetPosition.y, planetPosition.z]);
            planetData.trail.geometry.setAttribute('position', new THREE.Float32BufferAttribute(planetData.trailPoints.flat(), 3));
        }
    });

    controls.update();
    renderer.render(scene, camera);
}

animate();
